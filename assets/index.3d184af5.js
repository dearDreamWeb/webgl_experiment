var st=Object.defineProperty;var j=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var ve=(t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ge=(t,e)=>{for(var r in e||(e={}))Ae.call(e,r)&&ve(t,r,e[r]);if(j)for(var r of j(e))_e.call(e,r)&&ve(t,r,e[r]);return t};var be=(t,e)=>{var r={};for(var n in t)Ae.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&j)for(var n of j(t))e.indexOf(n)<0&&_e.call(t,n)&&(r[n]=t[n]);return r};import{t as se,j as Me,r as I,R as at}from"./vendor.6ea4d52d.js";const ht=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}};ht();function ot(t,e,r){const n=[[-.7,.5],[-.4,.3],[-.25,.71],[-.1,.56],[-.1,.13],[.4,.21],[0,-.6],[-.3,-.3],[-.6,-.3],[-.45,0]],i=[n.flat()],s=se.tesselate({contours:i,windingRule:se.WINDING_ODD,elementType:se.POLYGONS,polySize:3,vertexSize:2}),a=[];for(var h=0;h<s.elements.length;h+=3){var o=s.elements[h],l=s.elements[h+1],d=s.elements[h+2];a.push(s.vertices[o*2],s.vertices[o*2+1],s.vertices[l*2],s.vertices[l*2+1],s.vertices[d*2],s.vertices[d*2+1])}tt(t,a,"TRIANGLES");const{left:u,top:c}=e.getBoundingClientRect(),f=new Uint16Array(de(n.flat()));e.onmousemove=x=>{const{x:p,y:m}=x,y=2*(p-u)/e.width-1,v=1-2*(m-c)/e.height,A=ct({vertices:n,cells:f},new k(y,v));r(A)}}function lt(t,e,r,n){const i=e.copy().sub(t),s=r.copy().sub(e),a=t.copy().sub(r),h=n.copy().sub(t),o=n.copy().sub(e),l=n.copy().sub(r),d=Math.sign(i.cross(h));let u=i.dot(h)/i.length**2;if(d===0&&u>=0&&u<=1)return!0;const c=Math.sign(s.cross(o));if(u=s.dot(o)/s.length**2,c===0&&u>=0&&u<=1)return!0;const f=Math.sign(a.cross(l));return u=a.dot(l)/a.length**2,f===0&&u>=0&&u<=1?!0:d===c&&c===f}function ct({vertices:t,cells:e},r){let n=!1;for(let i=0;i<e.length;i+=3){const s=new k(...t[e[i]]),a=new k(...t[e[i+1]]),h=new k(...t[e[i+2]]);if(lt(s,a,h,r)){n=!0;break}}return n}function ut(t){const e=`
        attribute vec2 position;

        uniform float u_rotation;
        uniform float u_time;
        uniform float u_duration;
        uniform float u_scale;
        uniform vec2 u_dir;

        varying float vP;

        void main() {
        float p = min(1.0, u_time / u_duration);
        float rad = u_rotation + 3.14 * 10.0 * p;
        float scale = u_scale * p * (2.0 - p);
        vec2 offset = 2.0 * u_dir * p * p;
        mat3 translateMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            offset.x, offset.y, 1.0
        );
        mat3 rotateMatrix = mat3(
            cos(rad), sin(rad), 0.0,
            -sin(rad), cos(rad), 0.0,
            0.0, 0.0, 1.0
        );
        mat3 scaleMatrix = mat3(
            scale, 0.0, 0.0,
            0.0, scale, 0.0,
            0.0, 0.0, 1.0
        );
        mat3 skewMatrix = mat3(
            1.0, 0.5, 0.0,
            0.3, 1.0, 0.0,
            0.0, 0.0, 1.0
        );
        gl_PointSize = 1.0;
        vec3 pos = translateMatrix * rotateMatrix * scaleMatrix * skewMatrix * vec3(position, 1.0);
        gl_Position = vec4(pos, 1.0);
        vP = p;
        }
    `,r=`
        precision mediump float;
        uniform vec4 u_color;
        varying float vP;

        void main()
        {
        gl_FragColor.xyz = u_color.xyz;
        gl_FragColor.a = (1.0 - vP) * u_color.a;
        }  
    `,n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,r),t.compileShader(i);const s=t.createProgram();t.attachShader(s,n),t.attachShader(s,i),t.linkProgram(s),t.useProgram(s);const a=new Float32Array([-1,-1,0,1,1,-1]),h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW);const o=t.getAttribLocation(s,"position");t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o);let l=[];function d(){for(let u=0;u<5*Math.random();u++)l.push(ft());t.clear(t.COLOR_BUFFER_BIT),l.forEach(u=>{u.u_time=(performance.now()-u.startTime)/1e3,dt(t,s,u),t.drawArrays(t.TRIANGLES,0,a.length/2)}),l=l.filter(u=>u.u_time<=u.u_duration),requestAnimationFrame(d)}requestAnimationFrame(d)}function ft(){const t=[Math.random(),Math.random(),Math.random(),1],e=Math.random()*Math.PI,r=Math.random()*.05+.03,n=0,i=3,s=Math.random()*Math.PI*2,a=[Math.cos(s),Math.sin(s)],h=performance.now();return{u_color:t,u_rotation:e,u_scale:r,u_time:n,u_duration:i,u_dir:a,startTime:h}}function dt(t,e,{u_color:r,u_rotation:n,u_scale:i,u_time:s,u_duration:a,u_dir:h}){let o=t.getUniformLocation(e,"u_color");t.uniform4fv(o,r),o=t.getUniformLocation(e,"u_rotation"),t.uniform1f(o,n),o=t.getUniformLocation(e,"u_scale"),t.uniform1f(o,i),o=t.getUniformLocation(e,"u_time"),t.uniform1f(o,s),o=t.getUniformLocation(e,"u_duration"),t.uniform1f(o,a),o=t.getUniformLocation(e,"u_dir"),t.uniform2fv(o,h)}function Fe(t){let e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function ae(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function xt(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function we(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Re(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function pt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function mt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function he(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function yt(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}function Et(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function Te(t){let e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function At(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function _t(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function oe(t,e){let r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Se(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ce(t,e,r){let n=e[0],i=e[1],s=e[2],a=r[0],h=r[1],o=r[2];return t[0]=i*o-s*h,t[1]=s*a-n*o,t[2]=n*h-i*a,t}function vt(t,e,r,n){let i=e[0],s=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=a+n*(r[2]-a),t}function gt(t,e,r){let n=e[0],i=e[1],s=e[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a,t}function bt(t,e,r){let n=e[0],i=e[1],s=e[2],a=r[0],h=r[1],o=r[2],l=r[3],d=h*s-o*i,u=o*n-a*s,c=a*i-h*n,f=h*c-o*u,x=o*d-a*c,p=a*u-h*d,m=l*2;return d*=m,u*=m,c*=m,f*=2,x*=2,p*=2,t[0]=n+d+f,t[1]=i+u+x,t[2]=s+c+p,t}const Mt=function(){const t=[0,0,0],e=[0,0,0];return function(r,n){ae(t,r),ae(e,n),oe(t,t),oe(e,e);let i=Se(t,e);return i>1?0:i<-1?Math.PI:Math.acos(i)}}();function Ft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class w extends Array{constructor(e=0,r=e,n=e){super(e,r,n);return this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,r=e,n=e){return e.length?this.copy(e):(xt(this,e,r,n),this)}copy(e){return ae(this,e),this}add(e,r){return r?we(this,e,r):we(this,this,e),this}sub(e,r){return r?Re(this,e,r):Re(this,this,e),this}multiply(e){return e.length?pt(this,this,e):he(this,this,e),this}divide(e){return e.length?mt(this,this,e):he(this,this,1/e),this}inverse(e=this){return _t(this,e),this}len(){return Fe(this)}distance(e){return e?yt(this,e):Fe(this)}squaredLen(){return Te(this)}squaredDistance(e){return e?Et(this,e):Te(this)}negate(e=this){return At(this,e),this}cross(e,r){return r?Ce(this,e,r):Ce(this,this,e),this}scale(e){return he(this,this,e),this}normalize(){return oe(this,this),this}dot(e){return Se(this,e)}equals(e){return Ft(this,e)}applyMatrix4(e){return gt(this,this,e),this}applyQuaternion(e){return bt(this,this,e),this}angle(e){return Mt(this,e)}lerp(e,r){return vt(this,this,e,r),this}clone(){return new w(this[0],this[1],this[2])}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e}transformDirection(e){const r=this[0],n=this[1],i=this[2];return this[0]=e[0]*r+e[4]*n+e[8]*i,this[1]=e[1]*r+e[5]*n+e[9]*i,this[2]=e[2]*r+e[6]*n+e[10]*i,this.normalize()}}const Be=new w;let wt=1,Rt=1,Pe=!1;class Tt{constructor(e,r={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=r,this.id=wt++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let n in r)this.addAttribute(n,r[n])}addAttribute(e,r){if(this.attributes[e]=r,r.id=Rt++,r.size=r.size||1,r.type=r.type||(r.data.constructor===Float32Array?this.gl.FLOAT:r.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),r.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,r.normalized=r.normalized||!1,r.stride=r.stride||0,r.offset=r.offset||0,r.count=r.count||(r.stride?r.data.byteLength/r.stride:r.data.length/r.size),r.divisor=r.instanced||0,r.needsUpdate=!1,r.buffer||(r.buffer=this.gl.createBuffer(),this.updateAttribute(r)),r.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==r.count*r.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,r.count*r.divisor);this.instancedCount=r.count*r.divisor}else e==="index"?this.drawRange.count=r.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,r.count))}updateAttribute(e){this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),this.gl.bufferData(e.target,e.data,this.gl.STATIC_DRAW),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,r){this.drawRange.start=e,this.drawRange.count=r}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((r,n)=>{if(!this.attributes[n]){console.warn(`active attribute ${n} not being supplied`);return}const i=this.attributes[n];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.buffer,this.gl.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),this.gl.enableVertexAttribArray(r),this.gl.renderer.vertexAttribDivisor(r,i.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:r=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((n,i)=>{const s=this.attributes[i];s.needsUpdate&&this.updateAttribute(s)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(r,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(r,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*2):this.gl.drawArrays(r,this.drawRange.start,this.drawRange.count)}getPositionArray(){const e=this.attributes.position;if(e.min)return[...e.min,...e.max];if(e.data)return e.data;if(!Pe)return console.warn("No position buffer data found to compute bounds"),Pe=!0}computeBoundingBox(e){e||(e=this.getPositionArray()),this.bounds||(this.bounds={min:new w,max:new w,center:new w,scale:new w,radius:1/0});const r=this.bounds.min,n=this.bounds.max,i=this.bounds.center,s=this.bounds.scale;r.set(1/0),n.set(-1/0);for(let a=0,h=e.length;a<h;a+=3){const o=e[a],l=e[a+1],d=e[a+2];r.x=Math.min(o,r.x),r.y=Math.min(l,r.y),r.z=Math.min(d,r.z),n.x=Math.max(o,n.x),n.y=Math.max(l,n.y),n.z=Math.max(d,n.z)}s.sub(n,r),i.add(r,n).divide(2)}computeBoundingSphere(e){e||(e=this.getPositionArray()),this.bounds||this.computeBoundingBox(e);let r=0;for(let n=0,i=e.length;n<i;n+=3)Be.fromArray(e,n),r=Math.max(r,this.bounds.center.squaredDistance(Be));this.bounds.radius=Math.sqrt(r)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let St=1;const Le={};class Ct{constructor(e,{vertex:r,fragment:n,uniforms:i={},transparent:s=!1,cullFace:a=e.BACK,frontFace:h=e.CCW,depthTest:o=!0,depthWrite:l=!0,depthFunc:d=e.LESS}={}){e.canvas||console.error("gl not passed as fist argument to Program"),this.gl=e,this.uniforms=i,this.id=St++,r||console.warn("vertex shader not supplied"),n||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=a,this.frontFace=h,this.depthTest=o,this.depthWrite=l,this.depthFunc=d,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const u=e.createShader(e.VERTEX_SHADER);e.shaderSource(u,r),e.compileShader(u),e.getShaderInfoLog(u)!==""&&console.warn(`${e.getShaderInfoLog(u)}
Vertex Shader
${De(r)}`);const c=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(c,n),e.compileShader(c),e.getShaderInfoLog(c)!==""&&console.warn(`${e.getShaderInfoLog(c)}
Fragment Shader
${De(n)}`),this.program=e.createProgram(),e.attachShader(this.program,u),e.attachShader(this.program,c),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(u),e.deleteShader(c),this.uniformLocations=new Map;let f=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS);for(let m=0;m<f;m++){let y=e.getActiveUniform(this.program,m);this.uniformLocations.set(y,e.getUniformLocation(this.program,y.name));const v=y.name.match(/(\w+)/g);y.uniformName=v[0],v.length===3?(y.isStructArray=!0,y.structIndex=Number(v[1]),y.structProperty=v[2]):v.length===2&&isNaN(Number(v[1]))&&(y.isStruct=!0,y.structProperty=v[1])}this.attributeLocations=new Map;const x=[],p=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES);for(let m=0;m<p;m++){const y=e.getActiveAttrib(this.program,m),v=e.getAttribLocation(this.program,y.name);x[v]=y.name,this.attributeLocations.set(y.name,v)}this.attributeOrder=x.join("")}setBlendFunc(e,r,n,i){this.blendFunc.src=e,this.blendFunc.dst=r,this.blendFunc.srcAlpha=n,this.blendFunc.dstAlpha=i,e&&(this.transparent=!0)}setBlendEquation(e,r){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=r}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let r=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((i,s)=>{let a=s.uniformName,h=this.uniforms[a];if(s.isStruct&&(h=h[s.structProperty],a+=`.${s.structProperty}`),s.isStructArray&&(h=h[s.structIndex][s.structProperty],a+=`[${s.structIndex}].${s.structProperty}`),!h)return Ie(`Active uniform ${a} has not been supplied`);if(h&&h.value===void 0)return Ie(`${a} uniform is missing a value parameter`);if(h.value.texture)return r=r+1,h.value.update(r),le(this.gl,s.type,i,r);if(h.value.length&&h.value[0].texture){const o=[];return h.value.forEach(l=>{r=r+1,l.update(r),o.push(r)}),le(this.gl,s.type,i,o)}le(this.gl,s.type,i,h.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function le(t,e,r,n){n=n.length?Bt(n):n;const i=t.renderer.state.uniformLocations.get(r);if(n.length)if(i===void 0)t.renderer.state.uniformLocations.set(r,n.slice(0));else{if(Pt(i,n))return;i.set?i.set(n):Lt(i,n),t.renderer.state.uniformLocations.set(r,i)}else{if(i===n)return;t.renderer.state.uniformLocations.set(r,n)}switch(e){case 5126:return n.length?t.uniform1fv(r,n):t.uniform1f(r,n);case 35664:return t.uniform2fv(r,n);case 35665:return t.uniform3fv(r,n);case 35666:return t.uniform4fv(r,n);case 35670:case 5124:case 35678:case 35680:return n.length?t.uniform1iv(r,n):t.uniform1i(r,n);case 35671:case 35667:return t.uniform2iv(r,n);case 35672:case 35668:return t.uniform3iv(r,n);case 35673:case 35669:return t.uniform4iv(r,n);case 35674:return t.uniformMatrix2fv(r,!1,n);case 35675:return t.uniformMatrix3fv(r,!1,n);case 35676:return t.uniformMatrix4fv(r,!1,n)}}function De(t){let e=t.split(`
`);for(let r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join(`
`)}function Bt(t){const e=t.length,r=t[0].length;if(r===void 0)return t;const n=e*r;let i=Le[n];i||(Le[n]=i=new Float32Array(n));for(let s=0;s<e;s++)i.set(t[s],s*r);return i}function Pt(t,e){if(t.length!==e.length)return!1;for(let r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function Lt(t,e){for(let r=0,n=t.length;r<n;r++)t[r]=e[r]}let ce=0;function Ie(t){ce>100||(console.warn(t),ce++,ce>100&&console.warn("More than 100 program warnings - stopping logs."))}const ue=new w;let Dt=1;class It{constructor({canvas:e=document.createElement("canvas"),width:r=300,height:n=150,dpr:i=1,alpha:s=!1,depth:a=!0,stencil:h=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:d=!1,powerPreference:u="default",autoClear:c=!0,webgl:f=2}={}){const x={alpha:s,depth:a,stencil:h,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:d,powerPreference:u};this.dpr=i,this.alpha=s,this.color=!0,this.depth=a,this.stencil=h,this.premultipliedAlpha=l,this.autoClear=c,this.id=Dt++,f===2&&(this.gl=e.getContext("webgl2",x)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",x)||e.getContext("experimental-webgl",x)),this.gl.renderer=this,this.setSize(r,n),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,r){this.width=e,this.height=r,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=r*this.dpr,Object.assign(this.gl.canvas.style,{width:e+"px",height:r+"px"})}setViewport(e,r){this.state.viewport.width===e&&this.state.viewport.height===r||(this.state.viewport.width=e,this.state.viewport.height=r,this.gl.viewport(0,0,e,r))}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,r,n,i){this.state.blendFunc.src===e&&this.state.blendFunc.dst===r&&this.state.blendFunc.srcAlpha===n&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=e,this.state.blendFunc.dst=r,this.state.blendFunc.srcAlpha=n,this.state.blendFunc.dstAlpha=i,n!==void 0?this.gl.blendFuncSeparate(e,r,n,i):this.gl.blendFunc(e,r))}setBlendEquation(e,r){this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===r||(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=r,r!==void 0?this.gl.blendEquationSeparate(e,r):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:r=null}={}){this.state.framebuffer!==r&&(this.state.framebuffer=r,this.gl.bindFramebuffer(e,r))}getExtension(e,r,n){return r&&this.gl[r]?this.gl[r].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),r?this.extensions[e]?this.extensions[e][n].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:e.zDepth!==r.zDepth?e.zDepth-r.zDepth:r.id-e.id}sortTransparent(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.zDepth!==r.zDepth?r.zDepth-e.zDepth:r.id-e.id}sortUI(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:r.id-e.id}getRenderList({scene:e,camera:r,frustumCull:n,sort:i}){let s=[];if(r&&n&&r.updateFrustum(),e.traverse(a=>{if(!a.visible)return!0;!a.draw||n&&a.frustumCulled&&r&&!r.frustumIntersectsMesh(a)||s.push(a)}),i){const a=[],h=[],o=[];s.forEach(l=>{l.program.transparent?l.program.depthTest?h.push(l):o.push(l):a.push(l),l.zDepth=0,!(l.renderOrder!==0||!l.program.depthTest||!r)&&(l.worldMatrix.getTranslation(ue),ue.applyMatrix4(r.projectionViewMatrix),l.zDepth=ue.z)}),a.sort(this.sortOpaque),h.sort(this.sortTransparent),o.sort(this.sortUI),s=a.concat(h,o)}return s}render({scene:e,camera:r,target:n=null,update:i=!0,sort:s=!0,frustumCull:a=!0,clear:h}){n===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(h||this.autoClear&&h!==!1)&&(this.depth&&(!n||n.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&e.updateMatrixWorld(),r&&r.updateMatrixWorld(),this.getRenderList({scene:e,camera:r,frustumCull:a,sort:s}).forEach(l=>{l.draw({camera:r})})}}function zt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ut(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function Nt(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=r*r+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=s*a,t}function Ot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function kt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Vt(t,e,r){r=r*.5;let n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function ze(t,e,r){let n=e[0],i=e[1],s=e[2],a=e[3],h=r[0],o=r[1],l=r[2],d=r[3];return t[0]=n*d+a*h+i*l-s*o,t[1]=i*d+a*o+s*h-n*l,t[2]=s*d+a*l+n*o-i*h,t[3]=a*d-n*h-i*o-s*l,t}function Xt(t,e,r){r*=.5;let n=e[0],i=e[1],s=e[2],a=e[3],h=Math.sin(r),o=Math.cos(r);return t[0]=n*o+a*h,t[1]=i*o+s*h,t[2]=s*o-i*h,t[3]=a*o-n*h,t}function $t(t,e,r){r*=.5;let n=e[0],i=e[1],s=e[2],a=e[3],h=Math.sin(r),o=Math.cos(r);return t[0]=n*o-s*h,t[1]=i*o+a*h,t[2]=s*o+n*h,t[3]=a*o-i*h,t}function Gt(t,e,r){r*=.5;let n=e[0],i=e[1],s=e[2],a=e[3],h=Math.sin(r),o=Math.cos(r);return t[0]=n*o+i*h,t[1]=i*o-n*h,t[2]=s*o+a*h,t[3]=a*o-s*h,t}function Zt(t,e,r,n){let i=e[0],s=e[1],a=e[2],h=e[3],o=r[0],l=r[1],d=r[2],u=r[3],c,f,x,p,m;return f=i*o+s*l+a*d+h*u,f<0&&(f=-f,o=-o,l=-l,d=-d,u=-u),1-f>1e-6?(c=Math.acos(f),x=Math.sin(c),p=Math.sin((1-n)*c)/x,m=Math.sin(n*c)/x):(p=1-n,m=n),t[0]=p*i+m*o,t[1]=p*s+m*l,t[2]=p*a+m*d,t[3]=p*h+m*u,t}function Yt(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=r*r+n*n+i*i+s*s,h=a?1/a:0;return t[0]=-r*h,t[1]=-n*h,t[2]=-i*h,t[3]=s*h,t}function qt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ht(t,e){let r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);let s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[s*3+a]-e[a*3+s])*n,t[s]=(e[s*3+i]+e[i*3+s])*n,t[a]=(e[a*3+i]+e[i*3+a])*n}return t}function Wt(t,e,r="YXZ"){let n=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),a=Math.cos(e[1]*.5),h=Math.sin(e[2]*.5),o=Math.cos(e[2]*.5);return r==="XYZ"?(t[0]=n*a*o+i*s*h,t[1]=i*s*o-n*a*h,t[2]=i*a*h+n*s*o,t[3]=i*a*o-n*s*h):r==="YXZ"?(t[0]=n*a*o+i*s*h,t[1]=i*s*o-n*a*h,t[2]=i*a*h-n*s*o,t[3]=i*a*o+n*s*h):r==="ZXY"?(t[0]=n*a*o-i*s*h,t[1]=i*s*o+n*a*h,t[2]=i*a*h+n*s*o,t[3]=i*a*o-n*s*h):r==="ZYX"?(t[0]=n*a*o-i*s*h,t[1]=i*s*o+n*a*h,t[2]=i*a*h-n*s*o,t[3]=i*a*o+n*s*h):r==="YZX"?(t[0]=n*a*o+i*s*h,t[1]=i*s*o+n*a*h,t[2]=i*a*h-n*s*o,t[3]=i*a*o-n*s*h):r==="XZY"&&(t[0]=n*a*o-i*s*h,t[1]=i*s*o-n*a*h,t[2]=i*a*h+n*s*o,t[3]=i*a*o+n*s*h),t}const jt=zt,Qt=Ut,Kt=Ot,Jt=Nt;class $ extends Array{constructor(e=0,r=0,n=0,i=1){super(e,r,n,i);return this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set w(e){this[3]=e,this.onChange()}identity(){return kt(this),this.onChange(),this}set(e,r,n,i){return e.length?this.copy(e):(Qt(this,e,r,n,i),this.onChange(),this)}rotateX(e){return Xt(this,this,e),this.onChange(),this}rotateY(e){return $t(this,this,e),this.onChange(),this}rotateZ(e){return Gt(this,this,e),this.onChange(),this}inverse(e=this){return Yt(this,e),this.onChange(),this}conjugate(e=this){return qt(this,e),this.onChange(),this}copy(e){return jt(this,e),this.onChange(),this}normalize(e=this){return Jt(this,e),this.onChange(),this}multiply(e,r){return r?ze(this,e,r):ze(this,this,e),this.onChange(),this}dot(e){return Kt(this,e)}fromMatrix3(e){return Ht(this,e),this.onChange(),this}fromEuler(e){return Wt(this,e,e.order),this}fromAxisAngle(e,r){return Vt(this,e,r),this}slerp(e,r){return Zt(this,this,e,r),this}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this[3]=e[r+3],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e[r+3]=this[3],e}}const er=1e-6;function tr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rr(t,e,r,n,i,s,a,h,o,l,d,u,c,f,x,p,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=a,t[6]=h,t[7]=o,t[8]=l,t[9]=d,t[10]=u,t[11]=c,t[12]=f,t[13]=x,t[14]=p,t[15]=m,t}function nr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ir(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],h=e[5],o=e[6],l=e[7],d=e[8],u=e[9],c=e[10],f=e[11],x=e[12],p=e[13],m=e[14],y=e[15],v=r*h-n*a,A=r*o-i*a,E=r*l-s*a,_=n*o-i*h,b=n*l-s*h,T=i*l-s*o,B=d*p-u*x,S=d*m-c*x,L=d*y-f*x,g=u*m-c*p,P=u*y-f*p,M=c*y-f*m,F=v*M-A*P+E*g+_*L-b*S+T*B;return F?(F=1/F,t[0]=(h*M-o*P+l*g)*F,t[1]=(i*P-n*M-s*g)*F,t[2]=(p*T-m*b+y*_)*F,t[3]=(c*b-u*T-f*_)*F,t[4]=(o*L-a*M-l*S)*F,t[5]=(r*M-i*L+s*S)*F,t[6]=(m*E-x*T-y*A)*F,t[7]=(d*T-c*E+f*A)*F,t[8]=(a*P-h*L+l*B)*F,t[9]=(n*L-r*P-s*B)*F,t[10]=(x*b-p*E+y*v)*F,t[11]=(u*E-d*b-f*v)*F,t[12]=(h*S-a*g-o*B)*F,t[13]=(r*g-n*S+i*B)*F,t[14]=(p*A-x*_-m*v)*F,t[15]=(d*_-u*A+c*v)*F,t):null}function sr(t){let e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],h=t[6],o=t[7],l=t[8],d=t[9],u=t[10],c=t[11],f=t[12],x=t[13],p=t[14],m=t[15],y=e*a-r*s,v=e*h-n*s,A=e*o-i*s,E=r*h-n*a,_=r*o-i*a,b=n*o-i*h,T=l*x-d*f,B=l*p-u*f,S=l*m-c*f,L=d*p-u*x,g=d*m-c*x,P=u*m-c*p;return y*P-v*g+A*L+E*S-_*B+b*T}function Ue(t,e,r){let n=e[0],i=e[1],s=e[2],a=e[3],h=e[4],o=e[5],l=e[6],d=e[7],u=e[8],c=e[9],f=e[10],x=e[11],p=e[12],m=e[13],y=e[14],v=e[15],A=r[0],E=r[1],_=r[2],b=r[3];return t[0]=A*n+E*h+_*u+b*p,t[1]=A*i+E*o+_*c+b*m,t[2]=A*s+E*l+_*f+b*y,t[3]=A*a+E*d+_*x+b*v,A=r[4],E=r[5],_=r[6],b=r[7],t[4]=A*n+E*h+_*u+b*p,t[5]=A*i+E*o+_*c+b*m,t[6]=A*s+E*l+_*f+b*y,t[7]=A*a+E*d+_*x+b*v,A=r[8],E=r[9],_=r[10],b=r[11],t[8]=A*n+E*h+_*u+b*p,t[9]=A*i+E*o+_*c+b*m,t[10]=A*s+E*l+_*f+b*y,t[11]=A*a+E*d+_*x+b*v,A=r[12],E=r[13],_=r[14],b=r[15],t[12]=A*n+E*h+_*u+b*p,t[13]=A*i+E*o+_*c+b*m,t[14]=A*s+E*l+_*f+b*y,t[15]=A*a+E*d+_*x+b*v,t}function ar(t,e,r){let n=r[0],i=r[1],s=r[2],a,h,o,l,d,u,c,f,x,p,m,y;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*s+e[12],t[13]=e[1]*n+e[5]*i+e[9]*s+e[13],t[14]=e[2]*n+e[6]*i+e[10]*s+e[14],t[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],h=e[1],o=e[2],l=e[3],d=e[4],u=e[5],c=e[6],f=e[7],x=e[8],p=e[9],m=e[10],y=e[11],t[0]=a,t[1]=h,t[2]=o,t[3]=l,t[4]=d,t[5]=u,t[6]=c,t[7]=f,t[8]=x,t[9]=p,t[10]=m,t[11]=y,t[12]=a*n+d*i+x*s+e[12],t[13]=h*n+u*i+p*s+e[13],t[14]=o*n+c*i+m*s+e[14],t[15]=l*n+f*i+y*s+e[15]),t}function hr(t,e,r){let n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function or(t,e,r,n){let i=n[0],s=n[1],a=n[2],h=Math.hypot(i,s,a),o,l,d,u,c,f,x,p,m,y,v,A,E,_,b,T,B,S,L,g,P,M,F,G;return Math.abs(h)<er?null:(h=1/h,i*=h,s*=h,a*=h,o=Math.sin(r),l=Math.cos(r),d=1-l,u=e[0],c=e[1],f=e[2],x=e[3],p=e[4],m=e[5],y=e[6],v=e[7],A=e[8],E=e[9],_=e[10],b=e[11],T=i*i*d+l,B=s*i*d+a*o,S=a*i*d-s*o,L=i*s*d-a*o,g=s*s*d+l,P=a*s*d+i*o,M=i*a*d+s*o,F=s*a*d-i*o,G=a*a*d+l,t[0]=u*T+p*B+A*S,t[1]=c*T+m*B+E*S,t[2]=f*T+y*B+_*S,t[3]=x*T+v*B+b*S,t[4]=u*L+p*g+A*P,t[5]=c*L+m*g+E*P,t[6]=f*L+y*g+_*P,t[7]=x*L+v*g+b*P,t[8]=u*M+p*F+A*G,t[9]=c*M+m*F+E*G,t[10]=f*M+y*F+_*G,t[11]=x*M+v*F+b*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function lr(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ne(t,e){let r=e[0],n=e[1],i=e[2],s=e[4],a=e[5],h=e[6],o=e[8],l=e[9],d=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(s,a,h),t[2]=Math.hypot(o,l,d),t}function cr(t){let e=t[0],r=t[1],n=t[2],i=t[4],s=t[5],a=t[6],h=t[8],o=t[9],l=t[10];const d=e*e+r*r+n*n,u=i*i+s*s+a*a,c=h*h+o*o+l*l;return Math.sqrt(Math.max(d,u,c))}const ur=function(){const t=[0,0,0];return function(e,r){let n=t;Ne(n,r);let i=1/n[0],s=1/n[1],a=1/n[2],h=r[0]*i,o=r[1]*s,l=r[2]*a,d=r[4]*i,u=r[5]*s,c=r[6]*a,f=r[8]*i,x=r[9]*s,p=r[10]*a,m=h+u+p,y=0;return m>0?(y=Math.sqrt(m+1)*2,e[3]=.25*y,e[0]=(c-x)/y,e[1]=(f-l)/y,e[2]=(o-d)/y):h>u&&h>p?(y=Math.sqrt(1+h-u-p)*2,e[3]=(c-x)/y,e[0]=.25*y,e[1]=(o+d)/y,e[2]=(f+l)/y):u>p?(y=Math.sqrt(1+u-h-p)*2,e[3]=(f-l)/y,e[0]=(o+d)/y,e[1]=.25*y,e[2]=(c+x)/y):(y=Math.sqrt(1+p-h-u)*2,e[3]=(o-d)/y,e[0]=(f+l)/y,e[1]=(c+x)/y,e[2]=.25*y),e}}();function fr(t,e,r,n){let i=e[0],s=e[1],a=e[2],h=e[3],o=i+i,l=s+s,d=a+a,u=i*o,c=i*l,f=i*d,x=s*l,p=s*d,m=a*d,y=h*o,v=h*l,A=h*d,E=n[0],_=n[1],b=n[2];return t[0]=(1-(x+m))*E,t[1]=(c+A)*E,t[2]=(f-v)*E,t[3]=0,t[4]=(c-A)*_,t[5]=(1-(u+m))*_,t[6]=(p+y)*_,t[7]=0,t[8]=(f+v)*b,t[9]=(p-y)*b,t[10]=(1-(u+x))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function dr(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=r+r,h=n+n,o=i+i,l=r*a,d=n*a,u=n*h,c=i*a,f=i*h,x=i*o,p=s*a,m=s*h,y=s*o;return t[0]=1-u-x,t[1]=d+y,t[2]=c-m,t[3]=0,t[4]=d-y,t[5]=1-l-x,t[6]=f+p,t[7]=0,t[8]=c+m,t[9]=f-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xr(t,e,r,n,i){let s=1/Math.tan(e/2),a=1/(n-i);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t}function pr(t,e,r,n,i,s,a){let h=1/(e-r),o=1/(n-i),l=1/(s-a);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*h,t[13]=(i+n)*o,t[14]=(a+s)*l,t[15]=1,t}function mr(t,e,r,n){let i=e[0],s=e[1],a=e[2],h=n[0],o=n[1],l=n[2],d=i-r[0],u=s-r[1],c=a-r[2],f=d*d+u*u+c*c;f===0?c=1:(f=1/Math.sqrt(f),d*=f,u*=f,c*=f);let x=o*c-l*u,p=l*d-h*c,m=h*u-o*d;return f=x*x+p*p+m*m,f===0&&(l?h+=1e-6:o?l+=1e-6:o+=1e-6,x=o*c-l*u,p=l*d-h*c,m=h*u-o*d,f=x*x+p*p+m*m),f=1/Math.sqrt(f),x*=f,p*=f,m*=f,t[0]=x,t[1]=p,t[2]=m,t[3]=0,t[4]=u*m-c*p,t[5]=c*x-d*m,t[6]=d*p-u*x,t[7]=0,t[8]=d,t[9]=u,t[10]=c,t[11]=0,t[12]=i,t[13]=s,t[14]=a,t[15]=1,t}class V extends Array{constructor(e=1,r=0,n=0,i=0,s=0,a=1,h=0,o=0,l=0,d=0,u=1,c=0,f=0,x=0,p=0,m=1){super(e,r,n,i,s,a,h,o,l,d,u,c,f,x,p,m);return this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,r,n,i,s,a,h,o,l,d,u,c,f,x,p,m){return e.length?this.copy(e):(rr(this,e,r,n,i,s,a,h,o,l,d,u,c,f,x,p,m),this)}translate(e,r=this){return ar(this,r,e),this}rotate(e,r,n=this){return or(this,n,e,r),this}scale(e,r=this){return hr(this,r,typeof e=="number"?[e,e,e]:e),this}multiply(e,r){return r?Ue(this,e,r):Ue(this,this,e),this}identity(){return nr(this),this}copy(e){return tr(this,e),this}fromPerspective({fov:e,aspect:r,near:n,far:i}={}){return xr(this,e,r,n,i),this}fromOrthogonal({left:e,right:r,bottom:n,top:i,near:s,far:a}){return pr(this,e,r,n,i,s,a),this}fromQuaternion(e){return dr(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return ir(this,e),this}compose(e,r,n){return fr(this,e,r,n),this}getRotation(e){return ur(e,this),this}getTranslation(e){return lr(e,this),this}getScaling(e){return Ne(e,this),this}getMaxScaleOnAxis(){return cr(this)}lookAt(e,r,n){return mr(this,e,r,n),this}determinant(){return sr(this)}}function yr(t,e,r="YXZ"){return r==="XYZ"?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):r==="YXZ"?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):r==="ZXY"?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):r==="ZYX"?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):r==="YZX"?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):r==="XZY"&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}const Oe=new V;class Er extends Array{constructor(e=0,r=e,n=e,i="YXZ"){super(e,r,n);return this.order=i,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set(e,r=e,n=e){return e.length?this.copy(e):(this[0]=e,this[1]=r,this[2]=n,this.onChange(),this)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.onChange(),this}reorder(e){return this.order=e,this.onChange(),this}fromRotationMatrix(e,r=this.order){return yr(this,e,r),this}fromQuaternion(e,r=this.order){return Oe.fromQuaternion(e),this.fromRotationMatrix(Oe,r)}}class ke{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new V,this.worldMatrix=new V,this.matrixAutoUpdate=!0,this.position=new w,this.quaternion=new $,this.scale=new w(1),this.rotation=new Er,this.up=new w(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(e,r=!0){r&&this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,r&&e&&e.addChild(this,!1)}addChild(e,r=!0){~this.children.indexOf(e)||this.children.push(e),r&&e.setParent(this,!1)}removeChild(e,r=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),r&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let r=0,n=this.children.length;r<n;r++)this.children[r].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let r=0,n=this.children.length;r<n;r++)this.children[r].traverse(e)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,r=!1){r?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}new V;new w;new w;function Ar(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function _r(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=r+r,h=n+n,o=i+i,l=r*a,d=n*a,u=n*h,c=i*a,f=i*h,x=i*o,p=s*a,m=s*h,y=s*o;return t[0]=1-u-x,t[3]=d-y,t[6]=c+m,t[1]=d+y,t[4]=1-l-x,t[7]=f-p,t[2]=c-m,t[5]=f+p,t[8]=1-l-u,t}function vr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function gr(t,e,r,n,i,s,a,h,o,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=a,t[6]=h,t[7]=o,t[8]=l,t}function br(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mr(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],h=e[5],o=e[6],l=e[7],d=e[8],u=d*a-h*l,c=-d*s+h*o,f=l*s-a*o,x=r*u+n*c+i*f;return x?(x=1/x,t[0]=u*x,t[1]=(-d*n+i*l)*x,t[2]=(h*n-i*a)*x,t[3]=c*x,t[4]=(d*r-i*o)*x,t[5]=(-h*r+i*s)*x,t[6]=f*x,t[7]=(-l*r+n*o)*x,t[8]=(a*r-n*s)*x,t):null}function Ve(t,e,r){let n=e[0],i=e[1],s=e[2],a=e[3],h=e[4],o=e[5],l=e[6],d=e[7],u=e[8],c=r[0],f=r[1],x=r[2],p=r[3],m=r[4],y=r[5],v=r[6],A=r[7],E=r[8];return t[0]=c*n+f*a+x*l,t[1]=c*i+f*h+x*d,t[2]=c*s+f*o+x*u,t[3]=p*n+m*a+y*l,t[4]=p*i+m*h+y*d,t[5]=p*s+m*o+y*u,t[6]=v*n+A*a+E*l,t[7]=v*i+A*h+E*d,t[8]=v*s+A*o+E*u,t}function Fr(t,e,r){let n=e[0],i=e[1],s=e[2],a=e[3],h=e[4],o=e[5],l=e[6],d=e[7],u=e[8],c=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=s,t[3]=a,t[4]=h,t[5]=o,t[6]=c*n+f*a+l,t[7]=c*i+f*h+d,t[8]=c*s+f*o+u,t}function wr(t,e,r){let n=e[0],i=e[1],s=e[2],a=e[3],h=e[4],o=e[5],l=e[6],d=e[7],u=e[8],c=Math.sin(r),f=Math.cos(r);return t[0]=f*n+c*a,t[1]=f*i+c*h,t[2]=f*s+c*o,t[3]=f*a-c*n,t[4]=f*h-c*i,t[5]=f*o-c*s,t[6]=l,t[7]=d,t[8]=u,t}function Rr(t,e,r){let n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tr(t,e){let r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],h=e[5],o=e[6],l=e[7],d=e[8],u=e[9],c=e[10],f=e[11],x=e[12],p=e[13],m=e[14],y=e[15],v=r*h-n*a,A=r*o-i*a,E=r*l-s*a,_=n*o-i*h,b=n*l-s*h,T=i*l-s*o,B=d*p-u*x,S=d*m-c*x,L=d*y-f*x,g=u*m-c*p,P=u*y-f*p,M=c*y-f*m,F=v*M-A*P+E*g+_*L-b*S+T*B;return F?(F=1/F,t[0]=(h*M-o*P+l*g)*F,t[1]=(o*L-a*M-l*S)*F,t[2]=(a*P-h*L+l*B)*F,t[3]=(i*P-n*M-s*g)*F,t[4]=(r*M-i*L+s*S)*F,t[5]=(n*L-r*P-s*B)*F,t[6]=(p*T-m*b+y*_)*F,t[7]=(m*E-x*T-y*A)*F,t[8]=(x*b-p*E+y*v)*F,t):null}class Sr extends Array{constructor(e=1,r=0,n=0,i=0,s=1,a=0,h=0,o=0,l=1){super(e,r,n,i,s,a,h,o,l);return this}set(e,r,n,i,s,a,h,o,l){return e.length?this.copy(e):(gr(this,e,r,n,i,s,a,h,o,l),this)}translate(e,r=this){return Fr(this,r,e),this}rotate(e,r=this){return wr(this,r,e),this}scale(e,r=this){return Rr(this,r,e),this}multiply(e,r){return r?Ve(this,e,r):Ve(this,this,e),this}identity(){return br(this),this}copy(e){return vr(this,e),this}fromMatrix4(e){return Ar(this,e),this}fromQuaternion(e){return _r(this,e),this}fromBasis(e,r,n){return this.set(e[0],e[1],e[2],r[0],r[1],r[2],n[0],n[1],n[2]),this}inverse(e=this){return Mr(this,e),this}getNormalMatrix(e){return Tr(this,e),this}}let Cr=0;class Br extends ke{constructor(e,{geometry:r,program:n,mode:i=e.TRIANGLES,frustumCulled:s=!0,renderOrder:a=0}={}){super();e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=Cr++,this.geometry=r,this.program=n,this.mode=i,this.frustumCulled=s,this.renderOrder=a,this.modelViewMatrix=new V,this.normalMatrix=new Sr,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){this.beforeRenderCallbacks.forEach(n=>n&&n({mesh:this,camera:e})),e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let r=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:r}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(n=>n&&n({mesh:this,camera:e}))}}function Pr(t,e){return t[0]=e[0],t[1]=e[1],t}function Lr(t,e,r){return t[0]=e,t[1]=r,t}function Xe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function $e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Dr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Ir(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function fe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function zr(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function Ur(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Ge(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Nr(t){var e=t[0],r=t[1];return e*e+r*r}function Or(t,e){return t[0]=-e[0],t[1]=-e[1],t}function kr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Vr(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Xr(t,e){return t[0]*e[0]+t[1]*e[1]}function Ze(t,e){return t[0]*e[1]-t[1]*e[0]}function $r(t,e,r,n){var i=e[0],s=e[1];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t}function Gr(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function Zr(t,e,r){let n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function Yr(t,e){return t[0]===e[0]&&t[1]===e[1]}class z extends Array{constructor(e=0,r=e){super(e,r);return this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,r=e){return e.length?this.copy(e):(Lr(this,e,r),this)}copy(e){return Pr(this,e),this}add(e,r){return r?Xe(this,e,r):Xe(this,this,e),this}sub(e,r){return r?$e(this,e,r):$e(this,this,e),this}multiply(e){return e.length?Dr(this,this,e):fe(this,this,e),this}divide(e){return e.length?Ir(this,this,e):fe(this,this,1/e),this}inverse(e=this){return kr(this,e),this}len(){return Ge(this)}distance(e){return e?zr(this,e):Ge(this)}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?Ur(this,e):Nr(this)}negate(e=this){return Or(this,e),this}cross(e,r){return r?Ze(e,r):Ze(this,e)}scale(e){return fe(this,this,e),this}normalize(){return Vr(this,this),this}dot(e){return Xr(this,e)}equals(e){return Yr(this,e)}applyMatrix3(e){return Gr(this,this,e),this}applyMatrix4(e){return Zr(this,this,e),this}lerp(e,r){$r(this,this,e,r)}clone(){return new z(this[0],this[1])}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e}}new w;new z;new z;new w;new w;new w;new V;new w;new w;new w;new w;new w;new $;new w;new w;new $;new w;new V;new w;new w;new w;new w;new w;new $;new $;new $;new $;new V;function qr(){const t=`
  attribute vec2 position;

  void main() {
    gl_PointSize = 10.0;
    float scale = 1.0 / 256.0;
    mat3 projectionMatrix = mat3(
      scale, 0, 0,
      0, -scale, 0,
      -1, 1, 1
    );
    vec3 pos = projectionMatrix * vec3(position, 1);
    gl_Position = vec4(pos.xy, 0, 1);
  }
`,e=`
  precision highp float;
  void main() {
    gl_FragColor = vec4(1, 0, 0, 1);
  }
`,r=document.querySelector("canvas"),n=new It({canvas:r,width:800,height:800}),i=n.gl;i.clearColor(1,1,1,1);const s=new Ct(i,{vertex:t,fragment:e}),a=[new z(100,100),new z(100,200),new z(200,150),new z(300,200),new z(300,100)];function h(u,c,{thickness:f=10}={}){const x=.5*f,p=[],m=[];for(let E=1;E<c.length-1;E++){const _=new z().sub(c[E],c[E-1]).normalize(),b=new z().sub(c[E],c[E+1]).normalize(),T=new z().add(_,b).normalize(),B=new z(-_.y,_.x),S=B.dot(T),L=x/S;if(E===1){const g=new z(...B).scale(x);m.push(new z().add(c[0],g)),p.push(new z().sub(c[0],g))}if(T.scale(L),m.push(new z().add(c[E],T)),p.push(new z().sub(c[E],T)),E===c.length-2){const g=new z(b.y,-b.x),P=new z(...g).scale(x);m.push(new z().add(c[c.length-1],P)),p.push(new z().sub(c[c.length-1],P))}}const y=p.length*4-4,v=new Float32Array(y*2),A=new Uint16Array(6*y/4);for(let E=0;E<p.length-1;E++){const _=p[E],b=m[E],T=p[E+1],B=m[E+1],S=E*4;A.set([S,S+1,S+2,S+2,S+1,S+3],E*6),v.set([..._,...b,...T,...B],E*8)}return new Tt(u,{position:{size:2,data:v},index:{data:A}})}const o=h(i,a),l=new ke;new Br(i,{geometry:o,program:s}).setParent(l),n.render({scene:l})}function Hr(t){const e=new GlRenderer(t),r=`
      attribute vec2 a_vertexPosition;
      attribute float id;
      uniform float uTime;
  
      highp float random(vec2 co) {
        highp float a = 12.9898;
        highp float b = 78.233;
        highp float c = 43758.5453;
        highp float dt= dot(co.xy ,vec2(a,b));
        highp float sn= mod(dt,3.14);
        return fract(sin(sn) * c);
      }
      varying vec3 vColor;
      void main() {
        float t = id / 10000.0;
        float alpha = 6.28 * random(vec2(uTime, 2.0 + t));
        float c = cos(alpha);
        float s = sin(alpha);
        mat3 modelMatrix = mat3(
          c, -s, 0,
          s, c, 0,
          2.0 * random(vec2(uTime, t)) - 1.0, 2.0 * random(vec2(uTime, 1.0 + t)) - 1.0, 1
        );
        vec3 pos = modelMatrix * vec3(a_vertexPosition, 1);
        vColor = vec3(
          random(vec2(uTime, 4.0 + t)),
          random(vec2(uTime, 5.0 + t)),
          random(vec2(uTime, 6.0 + t))
        );
        gl_Position = vec4(pos, 1);
      }
    `,n=`
      #ifdef GL_ES
      precision highp float;
      #endif
      varying vec3 vColor;
      
      void main() {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    `,i=e.compileSync(n,r);e.useProgram(i);const s=2*Math.PI/3,a=2*s,h=6e3;e.setMeshData({positions:[[0,.1],[.1*Math.sin(s),.1*Math.cos(s)],[.1*Math.sin(a),.1*Math.cos(a)]],instanceCount:h,attributes:{id:{data:[...new Array(h).keys()],divisor:1}}});function o(l){e.uniforms.uTime=l/1e6,e.render(),requestAnimationFrame(o)}o(0)}class k extends Array{constructor(e=1,r=0){super(e,r)}set x(e){this[0]=e}set y(e){this[1]=e}get x(){return this[0]}get y(){return this[1]}get length(){return Math.hypot(this.x,this.y)}get dir(){return Math.atan2(this.y,this.x)}copy(){return new k(this.x,this.y)}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}scale(e){return this.x*=e,this.y*=e,this}cross(e){return this.x*e.y-e.x*this.y}dot(e){return this.x*e.x+e.y*this.y}normalize(){const e=Math.hypot(this.x,this.y);return this.scale(1/e)}rotate(e){const r=Math.cos(e),n=Math.sin(e),[i,s]=this;return this.x=i*r+s*-n,this.y=i*n+s*r,this}}function de(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length,s=Ye(t,0,i,r,!0),a=[];if(!s||s.next===s.prev)return a;var h,o,l,d,u,c,f;if(n&&(s=Jr(t,e,s,r)),t.length>80*r){h=l=t[0],o=d=t[1];for(var x=r;x<i;x+=r)u=t[x],c=t[x+1],u<h&&(h=u),c<o&&(o=c),u>l&&(l=u),c>d&&(d=c);f=Math.max(l-h,d-o),f=f!==0?1/f:0}return Y(s,a,r,h,o,f),a}function Ye(t,e,r,n,i){var s,a;if(i===me(t,e,r,n)>0)for(s=e;s<r;s+=n)a=We(s,t[s],t[s+1],a);else for(s=r-n;s>=e;s-=n)a=We(s,t[s],t[s+1],a);return a&&Q(a,a.next)&&(H(a),a=a.next),a}function X(t,e){if(!t)return t;e||(e=t);var r=t,n;do if(n=!1,!r.steiner&&(Q(r,r.next)||D(r.prev,r,r.next)===0)){if(H(r),r=e=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==e);return e}function Y(t,e,r,n,i,s,a){if(!!t){!a&&s&&sn(t,n,i,s);for(var h=t,o,l;t.prev!==t.next;){if(o=t.prev,l=t.next,s?jr(t,n,i,s):Wr(t)){e.push(o.i/r),e.push(t.i/r),e.push(l.i/r),H(t),t=l.next,h=l.next;continue}if(t=l,t===h){a?a===1?(t=Qr(X(t),e,r),Y(t,e,r,n,i,s,2)):a===2&&Kr(t,e,r,n,i,s):Y(X(t),e,r,n,i,s,1);break}}}}function Wr(t){var e=t.prev,r=t,n=t.next;if(D(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Z(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&D(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function jr(t,e,r,n){var i=t.prev,s=t,a=t.next;if(D(i,s,a)>=0)return!1;for(var h=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,o=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,l=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,d=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,u=xe(h,o,e,r,n),c=xe(l,d,e,r,n),f=t.prevZ,x=t.nextZ;f&&f.z>=u&&x&&x.z<=c;){if(f!==t.prev&&f!==t.next&&Z(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&D(f.prev,f,f.next)>=0||(f=f.prevZ,x!==t.prev&&x!==t.next&&Z(i.x,i.y,s.x,s.y,a.x,a.y,x.x,x.y)&&D(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&Z(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&D(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;x&&x.z<=c;){if(x!==t.prev&&x!==t.next&&Z(i.x,i.y,s.x,s.y,a.x,a.y,x.x,x.y)&&D(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Qr(t,e,r){var n=t;do{var i=n.prev,s=n.next.next;!Q(i,s)&&qe(i,n,n.next,s)&&q(i,s)&&q(s,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(s.i/r),H(n),H(n.next),n=t=s),n=n.next}while(n!==t);return X(n)}function Kr(t,e,r,n,i,s){var a=t;do{for(var h=a.next.next;h!==a.prev;){if(a.i!==h.i&&on(a,h)){var o=He(a,h);a=X(a,a.next),o=X(o,o.next),Y(a,e,r,n,i,s),Y(o,e,r,n,i,s);return}h=h.next}a=a.next}while(a!==t)}function Jr(t,e,r,n){var i=[],s,a,h,o,l;for(s=0,a=e.length;s<a;s++)h=e[s]*n,o=s<a-1?e[s+1]*n:t.length,l=Ye(t,h,o,n,!1),l===l.next&&(l.steiner=!0),i.push(hn(l));for(i.sort(en),s=0;s<i.length;s++)tn(i[s],r),r=X(r,r.next);return r}function en(t,e){return t.x-e.x}function tn(t,e){if(e=rn(t,e),e){var r=He(e,t);X(e,e.next),X(r,r.next)}}function rn(t,e){var r=e,n=t.x,i=t.y,s=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var h=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=n&&h>s){if(s=h,h===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!a)return null;if(n===s)return a;var o=a,l=a.x,d=a.y,u=1/0,c;r=a;do n>=r.x&&r.x>=l&&n!==r.x&&Z(i<d?n:s,i,l,d,i<d?s:n,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(n-r.x),q(r,t)&&(c<u||c===u&&(r.x>a.x||r.x===a.x&&nn(a,r)))&&(a=r,u=c)),r=r.next;while(r!==o);return a}function nn(t,e){return D(t.prev,t,e.prev)<0&&D(e.next,t,t.next)<0}function sn(t,e,r,n){var i=t;do i.z===null&&(i.z=xe(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,an(i)}function an(t){var e,r,n,i,s,a,h,o,l=1;do{for(r=t,t=null,s=null,a=0;r;){for(a++,n=r,h=0,e=0;e<l&&(h++,n=n.nextZ,!!n);e++);for(o=l;h>0||o>0&&n;)h!==0&&(o===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,h--):(i=n,n=n.nextZ,o--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}s.nextZ=null,l*=2}while(a>1);return t}function xe(t,e,r,n,i){return t=32767*(t-r)*i,e=32767*(e-n)*i,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function hn(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Z(t,e,r,n,i,s,a,h){return(i-a)*(e-h)-(t-a)*(s-h)>=0&&(t-a)*(n-h)-(r-a)*(e-h)>=0&&(r-a)*(s-h)-(i-a)*(n-h)>=0}function on(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!ln(t,e)&&(q(t,e)&&q(e,t)&&cn(t,e)&&(D(t.prev,t,e.prev)||D(t,e.prev,e))||Q(t,e)&&D(t.prev,t,t.next)>0&&D(e.prev,e,e.next)>0)}function D(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Q(t,e){return t.x===e.x&&t.y===e.y}function qe(t,e,r,n){var i=J(D(t,e,r)),s=J(D(t,e,n)),a=J(D(r,n,t)),h=J(D(r,n,e));return!!(i!==s&&a!==h||i===0&&K(t,r,e)||s===0&&K(t,n,e)||a===0&&K(r,t,n)||h===0&&K(r,e,n))}function K(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function J(t){return t>0?1:t<0?-1:0}function ln(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&qe(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function q(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function cn(t,e){var r=t,n=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function He(t,e){var r=new pe(t.i,t.x,t.y),n=new pe(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function We(t,e,r,n){var i=new pe(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function H(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pe(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}de.deviation=function(t,e,r,n){var i=e&&e.length,s=i?e[0]*r:t.length,a=Math.abs(me(t,0,s,r));if(i)for(var h=0,o=e.length;h<o;h++){var l=e[h]*r,d=h<o-1?e[h+1]*r:t.length;a-=Math.abs(me(t,l,d,r))}var u=0;for(h=0;h<n.length;h+=3){var c=n[h]*r,f=n[h+1]*r,x=n[h+2]*r;u+=Math.abs((t[c]-t[x])*(t[f+1]-t[c+1])-(t[c]-t[f])*(t[x+1]-t[c+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function me(t,e,r,n){for(var i=0,s=e,a=r-n;s<r;s+=n)i+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return i}de.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var a=0;a<e;a++)r.vertices.push(t[i][s][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var un="/webgl_experiment/assets/girl2.d0ce7541.jpg";let je=`
    attribute vec4 a_Position; //\u9876\u70B9\u4F4D\u7F6E\u5750\u6807
    attribute vec2 a_TexCoord; //\u7EB9\u7406\u5750\u6807
    varying vec2 v_TexCoord; //\u63D2\u503C\u540E\u7EB9\u7406\u5750\u6807
    void main(){
        gl_Position = a_Position; //\u9010\u9876\u70B9\u5904\u7406
        v_TexCoord = a_TexCoord; //\u7EB9\u7406\u5750\u6807\u63D2\u503C\u8BA1\u7B97
    }
  `,Qe=`
    precision highp float;  //\u6240\u6709float\u7C7B\u578B\u6570\u636E\u7684\u7CBE\u5EA6\u662Flowp
    varying vec2 v_TexCoord;  //\u63A5\u6536\u63D2\u503C\u540E\u7684\u7EB9\u7406\u5750\u6807
    uniform sampler2D u_Sampler;  //\u7EB9\u7406\u56FE\u7247\u50CF\u7D20\u6570\u636E
    uniform float brightness; //\u660E\u4EAE\u5EA6 \u533A\u95F4[-1,1]
    uniform mat4 hueMat;
    const mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);
    uniform lowp float saturation; // \u8272\u5F69\u9971\u548C\u5EA6 \u533A\u95F4[-2,2]


    void main(){ 
        // \u91C7\u96C6\u7EB9\u7D20
        vec4 texture = texture2D(u_Sampler,v_TexCoord); 
        // \u8BA1\u7B97RGB\u4E09\u4E2A\u5206\u91CF\u5149\u80FD\u91CF\u4E4B\u548C\uFF0C\u4E5F\u5C31\u662F\u4EAE\u5EA6
        // float luminance = 0.299*texture.r+0.587*texture.g+0.114*texture.b;

        lowp float luminance = dot(texture.rgb, luminanceWeighting);
        lowp vec3 greyScaleColor = vec3(luminance);

        vec4 color = vec4(texture.rgb + vec3(brightness,brightness,brightness),1.0);
        // \u9010\u7247\u5143\u8D4B\u503C\uFF0CRGB\u76F8\u540C\u5747\u4E3A\u4EAE\u5EA6\u503C\uFF0C\u7528\u9ED1\u767D\u4E24\u8272\u8868\u8FBE\u56FE\u7247\u7684\u660E\u6697\u53D8\u5316
        gl_FragColor = hueMat*vec4(mix(greyScaleColor, color.rgb, saturation),color.w);
    }
  `;function fn(t,e=0,r=0,n=1){t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);let i=Je(t,je,Qe),s=t.getAttribLocation(i,"a_Position"),a=t.getAttribLocation(i,"a_TexCoord"),h=t.getUniformLocation(i,"u_Sampler"),o=t.getUniformLocation(i,"brightness"),l=t.getUniformLocation(i,"hueMat"),d=t.getUniformLocation(i,"saturation");const u=Ke(r);t.uniform1f(o,e),t.uniformMatrix4fv(l,!1,u),t.uniform1f(d,1*n);let c=new Float32Array([-1,1,-1,-1,1,1,1,-1]),f=new Float32Array([0,1,0,0,1,1,1,0]),x=new Image;x.onload=y,x.src=un;let p=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);let m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,f,t.STATIC_DRAW),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);function y(){let v=t.createTexture();t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,v),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,x),t.uniform1i(h,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}function Ke(t){let e=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180);return new Float32Array([.213+r*.787-e*.213,.213-r*.213+e*.143,.213-r*.213-e*.787,0,.715-r*.715-e*.715,.715+r*.285+e*.14,.715-r*.715+e*.715,0,.072-r*.072+e*.928,.072-r*.072-e*.283,.072+r*.928+e*.072,0,0,0,0,1])}function Je(t,e,r){let n=t.createShader(t.VERTEX_SHADER),i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e),t.shaderSource(i,r),t.compileShader(n),t.compileShader(i);let s=t.createProgram();return t.attachShader(s,n),t.attachShader(s,i),t.linkProgram(s),t.useProgram(s),s}function dn(t,e,r=0,n=1){let i=Je(t,je,Qe),s=t.getUniformLocation(i,"brightness"),a=t.getUniformLocation(i,"saturation"),h=t.getUniformLocation(i,"hueMat");const o=Ke(r);t.uniformMatrix4fv(h,!1,o),t.uniform1f(s,e),console.log(r),t.uniform1f(a,1*n),t.drawArrays(t.TRIANGLE_STRIP,0,4)}function et({gl:t,xRange:e,yRange:r,zRange:n}){const a=ye(t,`
        precision mediump float;
        attribute vec3 a_Position;
        attribute vec3 a_Color;
        varying vec4 v_Color;
        //\u77E9\u9635x
        uniform mat4 mx;
        //\u77E9\u9635y
        uniform mat4 my;
        //\u77E9\u9635z
        uniform mat4 mz;

        void main(){
            gl_Position = mx*my*mz*vec4(a_Position,1.0);
            v_Color = vec4(a_Color,1.0);
        }
    `,`
        precision mediump float;
        varying vec4 v_Color;

        void main(){
            gl_FragColor = v_Color;
        }
    `),h=new Float32Array([-.5,-.5,.5,1,0,0,.5,-.5,.5,1,0,0,.5,.5,.5,1,0,0,-.5,.5,.5,1,0,0,-.5,.5,.5,0,1,0,-.5,.5,-.5,0,1,0,-.5,-.5,-.5,0,1,0,-.5,-.5,.5,0,1,0,.5,.5,.5,0,0,1,.5,-.5,.5,0,0,1,.5,-.5,-.5,0,0,1,.5,.5,-.5,0,0,1,.5,.5,-.5,1,0,1,.5,-.5,-.5,1,0,1,-.5,-.5,-.5,1,0,1,-.5,.5,-.5,1,0,1,-.5,.5,.5,1,1,0,.5,.5,.5,1,1,0,.5,.5,-.5,1,1,0,-.5,.5,-.5,1,1,0,-.5,-.5,.5,0,1,1,-.5,-.5,-.5,0,1,1,.5,-.5,-.5,0,1,1,.5,-.5,.5,0,1,1]),o=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),l=h.BYTES_PER_ELEMENT,d=t.createBuffer(),u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW);const c=t.getAttribLocation(a,"a_Position");t.vertexAttribPointer(c,3,t.FLOAT,!1,l*6,0),t.enableVertexAttribArray(c),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW);const f=t.getAttribLocation(a,"a_Color");t.vertexAttribPointer(f,3,t.FLOAT,!1,l*6,l*3),t.enableVertexAttribArray(f),t.enable(t.DEPTH_TEST),xn({gl:t,xRange:e,yRange:r,program:a,zRange:n}),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.drawElements(t.TRIANGLES,36,t.UNSIGNED_SHORT,0)}const xn=({gl:t,xRange:e,yRange:r,zRange:n,program:i})=>{const s=e*Math.PI/180*3.6,a=Math.cos(s),h=Math.sin(s),o=t.getUniformLocation(i,"mx"),l=new Float32Array([1,0,0,0,0,a,-h,0,0,h,a,0,0,0,0,1]);t.uniformMatrix4fv(o,!1,l);const d=r*Math.PI/180*3.6,u=Math.cos(d),c=Math.sin(d),f=t.getUniformLocation(i,"my"),x=new Float32Array([u,0,-c,0,0,1,0,0,c,0,u,0,0,0,0,1]);t.uniformMatrix4fv(f,!1,x);const p=n*Math.PI/180*3.6,m=Math.cos(p),y=Math.sin(p),v=t.getUniformLocation(i,"mz"),A=new Float32Array([m,y,0,0,-y,m,0,0,0,0,1,0,0,0,0,1]);t.uniformMatrix4fv(v,!1,A)};var pn="/webgl_experiment/assets/img0.34c768dd.jpeg",mn="/webgl_experiment/assets/img1.340c3d3d.jpeg";function yn(t,e,r){let n=t.createShader(t.VERTEX_SHADER),i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e),t.shaderSource(i,r),t.compileShader(n),t.compileShader(i);let s=t.createProgram();return t.attachShader(s,n),t.attachShader(s,i),t.linkProgram(s),t.useProgram(s),s}function En({gl:t}){let e=[],i=yn(t,`
        attribute vec2 a_Position;// \u9876\u70B9\u5750\u6807
        attribute vec2 a_PointUV;     // \u9876\u70B9UV
        varying vec2 v_PointUV;

        void main(){
            gl_Position = vec4(a_Position,0.0,1.0);
            v_PointUV = a_PointUV;
        }
    `,`
        precision mediump float;
        varying vec2 v_PointUV;
        uniform sampler2D u_Image;
        uniform sampler2D u_Image1;

        void main() {

            vec4 color = vec4(0.0);
    vec4 mask_src = vec4(0.0);

    vec4 cloth = vec4(0.0);
    vec4 mask = vec4(0.0);

    // Mask creation
    mask_src = texture2D(u_Image, v_PointUV).rgba;
    cloth = texture2D(u_Image1, v_PointUV).rgba;
    mask[3] = 1.0 - mask_src[2];
    if (mask_src[3] == 0.0) {
        mask[3] = 0.0;
    }

    // Alpha composite
    float w_color = mask[3] / (mask[3] + cloth[3] * (1.0 - mask[3]));
    color.rgb = mask.rgb *  (1.0 - w_color) + cloth.rgb * (1.0 - w_color);
    color[3] = mask[3] + cloth[3] * (1.0 - mask[3]);
    for (int i=0; i<3; i++) {
        color[i] = clamp(color[i],0.0,1.0);
    }

    if (cloth[3] == 0.0) {
        color.rgb = mask_src.rgb;
    }
    color[3] = mask_src[3];

    if (cloth[3] != 1.0 && mask_src[3] > 0.5) {
        color[3] = cloth[3] * 1.0;
    }

    gl_FragColor = color;
            // gl_FragColor = vec4(sample_color.xyz  * sample_color1.xyz ,1.0);
        }
    `);const s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),a();async function a(){let l=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,1,1,1,1,-1,1,0,1,-1,-1,0,0]);await o(0,pn),await o(1,mn);const d=l.BYTES_PER_ELEMENT;t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW);const u=t.getAttribLocation(i,"a_Position");t.vertexAttribPointer(u,2,t.FLOAT,!1,d*4,0),t.enableVertexAttribArray(u);const c=t.getAttribLocation(i,"a_PointUV");t.vertexAttribPointer(c,2,t.FLOAT,!1,d*4,d*2),t.enableVertexAttribArray(c);const f=t.getUniformLocation(i,"u_Image");t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,e[0]),t.uniform1i(f,0);const x=t.getUniformLocation(i,"u_Image1");t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,e[1]),t.uniform1i(x,1),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,l.length/4)}function h(l){return(l&l-1)==0}function o(l,d){return new Promise(u=>{const c=new Image;c.src=d||"./images/0.jpeg",c.crossOrigin="anonymous",c.onload=()=>{let f=t.createTexture();e.push(f),t.bindTexture(t.TEXTURE_2D,f),t.activeTexture(t.TEXTURE0+l),t.bindTexture(t.TEXTURE_2D,e[l]),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,c),h(c.width)&&h(c.height)?t.generateMipmap(t.TEXTURE_2D):(console.log("\u975E2\u7684\u6574\u6570\u6B21\u65B9"),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)),u(f)}})}}function ye(t,e,r){e=e||`
    attribute vec2 position;

    void main() {
        gl_PointSize = 1.0;
        gl_Position = vec4(position,0.0, 1.0);
    }
`,r=r||`
    void main() {
        gl_FragColor = vec4(1.0,0.0,0.0, 1.0);
    }
`;const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,r),t.compileShader(i);const s=t.createProgram();return t.attachShader(s,n),t.attachShader(s,i),t.linkProgram(s),t.useProgram(s),s}function tt(t,e,r){const n=`
      attribute vec2 position;

      void main() {
          gl_PointSize = 5.0;
          gl_Position = vec4(position,0.0, 1.0);
      }
  `,i=`
      void main() {
          gl_FragColor = vec4(1.0,0.0,0.0, 1.0);
      }
  `,s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,n),t.compileShader(s);const a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,i),t.compileShader(a);const h=t.createProgram();t.attachShader(h,s),t.attachShader(h,a),t.linkProgram(h),t.useProgram(h);let o=[];r==="helical"?o=e.map(c=>c/244):r==="star"?o=e.map(c=>c/5):r==="quadricBezier"?o=e.map(c=>c/196):o=[...e];const l=new Float32Array(o),d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW);const u=t.getAttribLocation(h,"position");t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u),r==="TRIANGLES"?t.drawArrays(t.TRIANGLES,0,l.length/2):t.drawArrays(t.LINE_STRIP,0,l.length/2)}function ee(t,e,r){return function(n,i,s=100,...a){const h=[];for(let o=0;o<=s;o++){const l=o/s,d=n*(1-l)+i*l,u=e(d,...a),c=r(d,...a);h.push(u,c)}return{draw:tt.bind(null,t,h),points:h}}}function An(t,e,r=0,n=0,i=0,s=0){const a=new Float32Array([-1,-1,0,1,1,-1]),h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),rt(t,e,3,r,n,i,s)}function _n(t,e,r){return[t[0],t[1],e[0],e[1],r[0],r[1]]}function vn(t,e,r,n=0,i=0){let s=0,a=0,h=0,o=0,l=[];const d=e*(1+n);for(;s<r;s++)o=2*Math.PI/r*s+i,a=d*Math.cos(o)+t[0],h=d*Math.sin(o)+t[1],l.push([a,h]);let u=[];for(s=0;s<r;s++)u.push(..._n(l[s],l[(s+1)%r],t));return u}function rt(t,e,r,n,i,s=0,a=0){s=(s-50)/50,a=(a-50)/50,i=i*3.6*(Math.PI/180),n=(n-50)/50;const h=t.getAttribLocation(e,"position"),o=vn([0,0],.5,r,n,i);o.forEach((c,f)=>{f%2==0?o[f]+=s:o[f]+=a});const l=new Float32Array(o),d=o.length/2;let u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(h),t.drawArrays(t.TRIANGLES,0,d)}const R=Me.exports.jsx,N=Me.exports.jsxs,W=t=>{const o=t,{type:e,value:r,setValue:n,onChangeHandler:i}=o,s=be(o,["type","value","setValue","onChangeHandler"]),[a,h]=I.exports.useState(r);return I.exports.useEffect(()=>{i(a)},[a]),R("input",ge({type:e||"range",value:a,onChange:l=>{h(Number(l.target.value))}},s))},U=[{key:"0",type:"polygon",text:"\u7ED8\u5236\u591A\u8FB9\u5F62"},{key:"1",type:"para",text:"\u7ED8\u5236\u629B\u7269\u7EBF"},{key:"2",type:"helical",text:"\u7ED8\u5236\u963F\u57FA\u7C73\u5FB7\u87BA\u65CB\u7EBF"},{key:"3",type:"star",text:"\u7ED8\u5236\u661F\u5F62\u7EBF"},{key:"4",type:"quadricBezier",text:"\u7ED8\u5236\u8D1D\u585E\u5C14\u66F2\u7EBF"},{key:"5",type:"triangulation",text:"\u4E09\u89D2\u5256\u5206"},{key:"6",type:"particleAnimation",text:"\u7C92\u5B50\u52A8\u753B"},{key:"7",type:"drawPolyline",text:"\u7ED8\u5236\u5E26\u5BBD\u5EA6\u7684\u66F2\u7EBF"},{key:"8",type:"performanceTest",text:"\u6027\u80FD\u68C0\u6D4B"},{key:"9",type:"filter",text:"\u6EE4\u955C"},{key:"10",type:"drawCube",text:"\u7ED8\u5236\u7ACB\u65B9\u4F53"},{key:"11",type:"imageFilter",text:"\u56FE\u7247\u53E0\u52A0\u6548\u679C"}];function gn(){const[t,e]=I.exports.useState(U[10].type),r=I.exports.useRef(null),[n,i]=I.exports.useState(3),[s,a]=I.exports.useState(50),[h,o]=I.exports.useState(50),[l,d]=I.exports.useState(50),[u,c]=I.exports.useState(0),[f,x]=I.exports.useState(50),[p,m]=I.exports.useState(50),[y,v]=I.exports.useState(10),[A,E]=I.exports.useState(10),[_,b]=I.exports.useState(0),[T,B]=I.exports.useState(50),[S,L]=I.exports.useState(!1),[g,P]=I.exports.useState();return I.exports.useEffect(()=>{!r.current||g||P(r.current.getContext("webgl"))},[t]),I.exports.useEffect(()=>{if(!g||!r.current)return;g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),r.current.onmousemove=null;const M=ye(g);switch(console.log(123),t){case U[0].type:An(g,M,l,u,s,h);break;case U[1].type:ee(g,C=>.05*C,C=>.05*C**2)(-10,10,1e5).draw("");break;case U[2].type:ee(g,(C,O)=>O*C*Math.cos(C),(C,O)=>O*C*Math.sin(C))(0,50,500,5).draw("helical");break;case U[3].type:ee(g,(C,O)=>O*Math.cos(C)**3,(C,O)=>O*Math.sin(C)**3)(0,Math.PI*2,500,5).draw("star");break;case U[4].type:const nt=ee(g,(C,[{x:O},{x:ne},{x:ie}])=>(1-C)**2*O+2*C*(1-C)*ne+C**2*ie,(C,[{y:O},{y:ne},{y:ie}])=>(1-C)**2*O+2*C*(1-C)*ne+C**2*ie),it=new k(0,0),te=new k(100,0);te.rotate(.75);const Ee=new k(200,0),re=30;for(let C=0;C<re;C++)te.rotate(2/re*Math.PI),Ee.rotate(2/re*Math.PI),nt(0,1,100,[it,te,Ee]).draw("quadricBezier");break;case U[5].type:ot(g,r.current,C=>L(C));break;case U[6].type:ut(g);break;case U[7].type:qr();break;case U[8].type:Hr(r.current);break;case U[9].type:fn(g,(f-50)/50,(p-50)*10,(T-(50-16.6))/16.6);break;case U[10].type:et({gl:g,xRange:y,yRange:A,zRange:_});break;case U[11].type:En({gl:g});break}},[t,g]),I.exports.useEffect(()=>{if(!r.current||t!==U[0].type||!g)return;const M=ye(g);rt(g,M,n,l,u,s,h)},[t,g,n,s,h,u,l]),I.exports.useEffect(()=>{!r.current||t!==U[9].type||!g||dn(g,(f-50)/50,(p-50)*10,(T-(50-16.6))/16.6)},[f,p,T]),I.exports.useEffect(()=>{!r.current||t!==U[10].type||!g||et({gl:g,xRange:y,yRange:A,zRange:_})},[y,A,_]),N("div",{className:"app",children:[R("div",{className:"app_nav",children:U.map((M,F)=>F!==6&&F!==8&&R("button",{className:`${M.type===t?"nav_active":""}`,onClick:()=>e(M.type),children:M.text},M.key))}),N("div",{className:"canvas_box",children:[R("canvas",{width:"800",height:"800",ref:r}),t===U[0].type&&N("div",{className:"polygon_box",children:[N("div",{className:"polygon_option",children:[R("p",{className:"polygon_option_text",children:"\u8FB9\u6570\uFF1A"}),R(W,{type:"text",value:n,onChangeHandler:M=>i(M),min:3})]}),N("div",{className:"polygon_option",children:[R("p",{className:"polygon_option_text",children:" x\u8F74\u79FB\u52A8\uFF1A"}),R(W,{value:s,onChangeHandler:M=>a(M)})]}),N("div",{className:"polygon_option",children:[R("p",{className:"polygon_option_text",children:" y\u8F74\u79FB\u52A8\uFF1A"}),R(W,{value:h,setValue:o,onChangeHandler:M=>o(M)})]}),N("div",{className:"polygon_option",children:[R("p",{className:"polygon_option_text",children:" \u65CB\u8F6C\uFF1A"}),R(W,{value:u,setValue:c,onChangeHandler:M=>c(M)})]}),N("div",{className:"polygon_option",children:[R("p",{className:"polygon_option_text",children:" \u7F29\u653E\uFF1A"}),R(W,{value:l,setValue:d,onChangeHandler:M=>d(M)})]})]}),S&&"\u9F20\u6807\u79FB\u5165\u56FE\u5F62\u4E2D\uFF01\uFF01\uFF01",t===U[9].type&&N("div",{className:"filter_box",children:[N("div",{children:[R("span",{className:"filter_item_label",children:"\u660E\u4EAE\u5EA6\uFF1A"}),R("input",{type:"range",value:f,onChange:M=>x(Number(M.target.value))})]}),N("div",{children:[R("span",{className:"filter_item_label",children:"\u8272\u76F8\uFF1A"}),R("input",{type:"range",value:p,onChange:M=>m(Number(M.target.value))})]}),N("div",{children:[R("span",{className:"filter_item_label",children:"\u9971\u548C\u5EA6\uFF1A"}),R("input",{type:"range",value:T,onChange:M=>B(Number(M.target.value))})]})]}),t===U[10].type&&N("div",{className:"filter_box",children:[N("div",{children:[R("span",{className:"filter_item_label",children:"x\u8F74\u65CB\u8F6C\u89D2\u5EA6\uFF1A"}),R("input",{type:"range",value:y,onChange:M=>v(Number(M.target.value))}),R("span",{children:Math.floor(y*3.6)})]}),N("div",{children:[R("span",{className:"filter_item_label",children:"y\u8F74\u65CB\u8F6C\u89D2\u5EA6\uFF1A"}),R("input",{type:"range",value:A,onChange:M=>E(Number(M.target.value))}),R("span",{children:Math.floor(A*3.6)})]}),N("div",{children:[R("span",{className:"filter_item_label",children:"z\u8F74\u65CB\u8F6C\u89D2\u5EA6\uFF1A"}),R("input",{type:"range",value:_,onChange:M=>b(Number(M.target.value))}),R("span",{children:Math.floor(_*3.6)})]})]})]})]})}at.render(R(gn,{}),document.getElementById("root"));
